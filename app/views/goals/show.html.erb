<div class="container my-4" data-controller="chart" data-chart-calorie-goal="<%= @goal.daily_calorie_target || 0 %>" data-chart-calories-consumed="<%= @goal.daily_calorie_target ? (@goal.daily_calorie_target - (@goal.daily_calorie_target * 0.28).to_i) : 0 %>">

  <!-- Navigation (Daily/Weekly/Monthly) -->
  <div class="d-flex justify-content-around mb-3">
    <%= link_to "Daily", "#" , class: "btn btn-outline-secondary active" %>
    <%= link_to "Weekly", "#" , class: "btn btn-outline-secondary" %>
    <%= link_to "Monthly", "#" , class: "btn btn-outline-secondary" %>
  </div>

  <!-- Calorie Goal Card -->
  <div class="card mb-3 p-3">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-0">
          <%= @goal.start_date.present? ? @goal.start_date.strftime("%B %d, %Y") : "No Start Date" %>
        </h5>
        <small class="text-muted">
          Calorie Goal:
          <%= @goal.daily_calorie_target.present? ? "#{@goal.daily_calorie_target} kcal" : "" %>
        </small>
      </div>
      <div class="text-end">
        <small class="text-muted">
          Consumed:
          <% consumed_calories = @goal.daily_calorie_target ? (@goal.daily_calorie_target - (@goal.daily_calorie_target * 0.28).to_i) : 0 %>
          <%= consumed_calories %> kcal
        </small>
      </div>
    </div>

    <!-- Donut Chart for Calorie Consumption -->
    <div class="mt-3">
      <canvas id="calorieChart" data-chart-target="calorieChart" width="400" height="200"></canvas>
    </div>
  </div>

  <!-- Meal Distribution Card -->
  <div class="card mb-3 p-3">
    <div class="d-flex justify-content-between mb-2">
      <div>
        <strong>Breakfast</strong>
        <small class="text-muted d-block">30% (220 kcal)</small>
      </div>
      <div>
        <strong>Dinner</strong>
        <small class="text-muted d-block">45% (400 kcal)</small>
      </div>
    </div>
    <div class="d-flex justify-content-between">
      <div>
        <strong>Lunch</strong>
        <small class="text-muted d-block">50% (440 kcal)</small>
        <small class="text-muted d-block">Total calorie consumed</small>
      </div>
      <div class="text-end">
        <small class="text-muted d-block">1200-1500</small>
        <small class="text-muted">Expected</small>
      </div>
    </div>
  </div>

  <!-- Macronutrient Bar Chart -->
    <div class="card p-3">
      <canvas id="macroChart" data-chart-target="macroChart" width="400" height="200"></canvas>
    </div>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-between mt-3">
    <%= link_to 'Edit Goal', edit_goal_path(@goal), class: "btn btn-primary" %>
    <%= link_to 'Back', goals_path, class: "btn btn-secondary" %>
  </div>

</div>

<script>
  document.addEventListener('turbo:load', function() {
    // Calorie Donut Chart
    const calorieCtx = document.getElementById('calorieChart').getContext('2d');
    const calorieGoal = <%= @goal.daily_calorie_target || 0 %>;
    const caloriesConsumed = <%= @goal.daily_calorie_target ? (@goal.daily_calorie_target - (@goal.daily_calorie_target * 0.28).to_i) : 0 %>;
    const caloriesRemaining = calorieGoal - caloriesConsumed;

    new Chart(calorieCtx, {
      type: 'doughnut',
      data: {
        labels: ['Consumed', 'Remaining'],
        datasets: [{
          data: [caloriesConsumed, caloriesRemaining],
          backgroundColor: ['rgba(54, 162, 235, 0.8)', 'rgba(200, 200, 200, 0.8)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Calorie Consumption'
        }
      }
    });

    // Macronutrient Bar Chart
    const macroCtx = document.getElementById('macroChart').getContext('2d');
    new Chart(macroCtx, {
      type: 'bar',
      data: {
        labels: ['Protein', 'Fats', 'Carbohydrates'],
        datasets: [{
          label: 'Consumed',
          data: [35, 30, 30], // Replace with actual data
          backgroundColor: 'rgba(75, 192, 192, 0.8)',
          borderWidth: 1
        },
        {
          label: 'Target',
          data: [80, 30, 50], // Replace with actual target data
          backgroundColor: 'rgba(255, 99, 132, 0.8)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        },
        legend: {
          position: 'bottom'
        },
        title: {
          display: true,
          text: 'Macronutrient Breakdown (grams)'
        }
      }
    });
  });
</script>